language: android
sudo: false
jdk: oraclejdk8
android:
  components:
  - tools
  - platform-tools
  - build-tools-23.0.2
  - android-23
  - extra-android-m2repository
before_install:
- openssl aes-256-cbc -K $encrypted_caf26dd8a009_key -iv $encrypted_caf26dd8a009_iv
  -in keys/evandroid.jks.enc -out keys/evandroid.jks -d
- gem install fir-cli
script:
- ./gradlew assembleRelease
- echo "TRAVIS_BRANCH = "$TRAVIS_BRANCH
- echo "TRAVIS_BUILD_DIR = "$TRAVIS_BUILD_DIR
- echo "TRAVIS_BUILD_ID = "$TRAVIS_BUILD_ID
- echo "TRAVIS_BUILD_NUMBER = "$TRAVIS_BUILD_NUMBER
- echo "TRAVIS_COMMIT = "$TRAVIS_COMMIT
- echo "TRAVIS_COMMIT_RANGE = "$TRAVIS_COMMIT_RANGE
- echo "TRAVIS_JOB_ID = "$TRAVIS_JOB_ID
- echo "TRAVIS_JOB_NUMBER = "$TRAVIS_JOB_NUMBER
- echo "TRAVIS_OS_NAME = "$TRAVIS_OS_NAME
- echo "TRAVIS_PULL_REQUEST = "$TRAVIS_PULL_REQUEST
- echo "TRAVIS_REPO_SLUG = "$TRAVIS_REPO_SLUG
- echo "TRAVIS_SECURE_ENV_VARS = "$TRAVIS_SECURE_ENV_VARS
- echo "TRAVIS_TEST_RESULT = "$TRAVIS_TEST_RESULT
- echo "TRAVIS_TAG = "$TRAVIS_TAG

deploy:
  provider: releases
  api_key:
    secure: rtDiwbMj+A7GhzeymS26b0LHaTbVkPxXISVulTrIE+mCGRReiN9nIyyqUsfq3iTvyCcCtXtRw/qUcOasCkoAO1ksY8YXzL9xkTIa0IBQTVn3ZUKNx4/gk9lF2OyXQ8BbfULje0CTjN0YiLPTzbbqzm4BGAu6p4nwAJKgGWHZwMxQdQW/+JVVvPdWdbrsO5KUMxtICICgbXN1EvXaPO2+VEZmC1xtbDko562bFWLABOWTCw0fGfY7g6ul2L15skBtLXvNDwSNoCZRSgeZFV27bejrR52wGIAGpfWVFj+x3tvMYIWI6ljdUlUhRxzcPeRSFKSgEDkzNfPEwHVp2rNwS+znGWJH0X6vWuezGEiMQnncjhw/zGYwe+ZGmKmg4KPwC/eWVmvsUWxuFcbb1fuhUbjxlKJ6gTNABQlXrHWhvjLE2hwWkPyo+ZugxqMoujTmUKhE1BUBxuW89dcmKMRNRf2TiKgTRkW9m1U8EEUeFXtOJzHL9IqeN2S516rlB1Hc6KhA1D6CVDgXiQwqwOWSoxePInwa5+5ti/9F4sFPxTIczUUt6XpbF6PA1rP03dwOlwSMef67oMuOR01lV1F6XCx2ECgZc9p/ap/W3V4Y5EKRMMY9k8Obt4FtE1bFpiobE2V5QKQJZNyG6ANMPYZuVc9n2pD0huuYF10YqLYWUSs=
  file: app/build/outputs/apk/app-release.apk
  skip_cleanup: true
  on:
    all_branches: true
    repo: nggirl/ContinuousDeploymentDemo
after_deploy:
- fir p app/build/outputs/apk/app-release.apk -T $FIR_TOKEN -c "`git cat-file tag $TRAVIS_TAG`"
- curl -d "appid=11457&to=logan676395@gmail.com,logan676@163.com&subject=[构建通知] 安卓新版本$TRAVIS_TAG发布&project=OonP52&signature=$SUBMAIL_SIGN&vars={\"TRAVIS_REPO_SLUG\":\"$TRAVIS_REPO_SLUG\",\"TRAVIS_TAG\":\"$TRAVIS_TAG\",\"TAG_DESCRIPTION\":\"$(git cat-file tag $TRAVIS_TAG | awk 1 ORS='<br>')\"}" https://api.submail.cn/mail/xsend.json
git:
  depth: 1